#include "gtest/gtest.h"
#include "../../src/loadlevel.cpp"
#include <fstream>
#include <sstream>

// Helper function to create a simple level file
void createLevelFile(const std::string& filename, const std::vector<std::string>& levelData) {
    std::ofstream file(filename);
    if (file.is_open()) {
        file << "** Start **\n";
        for (const auto& row : levelData) {
            file << row << "\n";
        }
        file << "** Stop **\n";
        file.close();
    } else {
        throw std::runtime_error("Unable to create level file: " + filename);
    }
}

TEST(LevelTest, InvalidFile) {
    const std::string filename = "no_level.txt";
    const bool result = read_levels_structure(filename);
    ASSERT_FALSE(result);
    ASSERT_TRUE(level_ranges.empty());
}

TEST(LevelTest, LoadEmptyLevel) {
    std::string filename = "empty_level.txt";
    createLevelFile(filename, {}); // Empty level data

    read_levels_structure(filename);

}

TEST(LevelTest, LoadSimpleLevel) {
    std::string filename = "simple_level.txt";
    createLevelFile(filename, {"0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000"});

    read_levels_structure(filename);

}

TEST(LevelTest, LoadLevelWithOneBrick) {
    std::string filename = "one_brick_level.txt";
    createLevelFile(filename, {"0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000",
                               "0000000000000000000000000000000000000000000000000000"});

    read_levels_structure(filename);
}